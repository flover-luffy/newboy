# ğŸ“… Newboy Webå‰ç«¯è¿œç¨‹éƒ¨ç½²åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

## ğŸ¯ é¡¹ç›®ç›®æ ‡
å°†Newboy Webç®¡ç†ç•Œé¢éƒ¨ç½²åˆ°GitHub Pagesï¼Œé€šè¿‡åå‘ä»£ç†è¿œç¨‹è¿æ¥åˆ°æ’ä»¶æœåŠ¡å™¨ï¼Œå®ç°å®‰å…¨çš„è¿œç¨‹ç®¡ç†ã€‚

## â±ï¸ æ€»ä½“æ—¶é—´å®‰æ’
**é¢„è®¡æ€»å·¥æœŸ**: 2-3å‘¨  
**æŠ€æœ¯éš¾åº¦**: ä¸­ç­‰  
**æ‰€éœ€æŠ€èƒ½**: Vue.jsã€Javaã€Nginx/Caddyã€LinuxåŸºç¡€

---

## ğŸš€ ç¬¬ä¸€é˜¶æ®µï¼šå‰ç«¯å¼€å‘ä¸æœ¬åœ°æµ‹è¯• (3-5å¤©)

### ğŸ“‹ ä»»åŠ¡æ¸…å•
- [ ] åˆ›å»ºVue 3 + TypeScriptå‰ç«¯é¡¹ç›®
- [ ] å®ç°æ ¸å¿ƒç®¡ç†ç•Œé¢
- [ ] é…ç½®ç¯å¢ƒå˜é‡å’ŒAPIå®¢æˆ·ç«¯
- [ ] æœ¬åœ°å¼€å‘ç¯å¢ƒæµ‹è¯•
- [ ] å‡†å¤‡GitHub Pageséƒ¨ç½²é…ç½®

### ğŸ› ï¸ è¯¦ç»†å®æ–½æ­¥éª¤

#### Day 1: é¡¹ç›®åˆå§‹åŒ–
```bash
# 1. åˆ›å»ºå‰ç«¯é¡¹ç›®
npm create vue@latest newboy-web-admin
cd newboy-web-admin

# é€‰æ‹©é…ç½®:
# âœ… TypeScript
# âœ… Router
# âœ… Pinia
# âœ… ESLint
# âœ… Prettier

# 2. å®‰è£…é¢å¤–ä¾èµ–
npm install axios element-plus @element-plus/icons-vue
npm install -D @types/node
```

#### Day 2-3: æ ¸å¿ƒç•Œé¢å¼€å‘

**é¡¹ç›®ç»“æ„**:
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”œâ”€â”€ Header.vue
â”‚   â”‚   â”œâ”€â”€ Sidebar.vue
â”‚   â”‚   â””â”€â”€ Layout.vue
â”‚   â”œâ”€â”€ Common/
â”‚   â”‚   â”œâ”€â”€ Loading.vue
â”‚   â”‚   â””â”€â”€ ErrorBoundary.vue
â”‚   â””â”€â”€ Charts/
â”‚       â””â”€â”€ StatusChart.vue
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ Dashboard.vue
â”‚   â”œâ”€â”€ Pocket48/
â”‚   â”‚   â”œâ”€â”€ RoomList.vue
â”‚   â”‚   â””â”€â”€ RoomDetail.vue
â”‚   â”œâ”€â”€ Weibo/
â”‚   â”‚   â”œâ”€â”€ UserList.vue
â”‚   â”‚   â””â”€â”€ TopicList.vue
â”‚   â”œâ”€â”€ Weidian/
â”‚   â”‚   â”œâ”€â”€ ShopList.vue
â”‚   â”‚   â””â”€â”€ ItemList.vue
â”‚   â”œâ”€â”€ System/
â”‚   â”‚   â”œâ”€â”€ Config.vue
â”‚   â”‚   â””â”€â”€ Logs.vue
â”‚   â””â”€â”€ Login.vue
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ client.ts
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ pocket48.ts
â”‚   â”œâ”€â”€ weibo.ts
â”‚   â”œâ”€â”€ weidian.ts
â”‚   â””â”€â”€ system.ts
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ config.ts
â”‚   â””â”€â”€ websocket.ts
â”œâ”€â”€ router/
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ config/
â”‚   â””â”€â”€ environment.ts
â””â”€â”€ utils/
    â”œâ”€â”€ request.ts
    â””â”€â”€ websocket.ts
```

**æ ¸å¿ƒç»„ä»¶ç¤ºä¾‹**:

**src/views/Dashboard.vue**
```vue
<template>
  <div class="dashboard">
    <el-row :gutter="20">
      <!-- ç³»ç»ŸçŠ¶æ€å¡ç‰‡ -->
      <el-col :span="6">
        <el-card class="status-card">
          <template #header>
            <span>ç³»ç»ŸçŠ¶æ€</span>
          </template>
          <div class="status-item">
            <el-tag :type="systemStatus.online ? 'success' : 'danger'">
              {{ systemStatus.online ? 'åœ¨çº¿' : 'ç¦»çº¿' }}
            </el-tag>
          </div>
        </el-card>
      </el-col>
      
      <!-- Pocket48è®¢é˜…ç»Ÿè®¡ -->
      <el-col :span="6">
        <el-card class="status-card">
          <template #header>
            <span>Pocket48</span>
          </template>
          <div class="status-item">
            <div>æˆ¿é—´æ•°: {{ pocket48Stats.totalRooms }}</div>
            <div>æ˜æ˜Ÿæ•°: {{ pocket48Stats.totalStars }}</div>
          </div>
        </el-card>
      </el-col>
      
      <!-- å¾®åšè®¢é˜…ç»Ÿè®¡ -->
      <el-col :span="6">
        <el-card class="status-card">
          <template #header>
            <span>å¾®åš</span>
          </template>
          <div class="status-item">
            <div>ç”¨æˆ·æ•°: {{ weiboStats.totalUsers }}</div>
            <div>è¯é¢˜æ•°: {{ weiboStats.totalTopics }}</div>
          </div>
        </el-card>
      </el-col>
      
      <!-- å¾®åº—è®¢é˜…ç»Ÿè®¡ -->
      <el-col :span="6">
        <el-card class="status-card">
          <template #header>
            <span>å¾®åº—</span>
          </template>
          <div class="status-item">
            <div>å•†åº—æ•°: {{ weidianStats.totalShops }}</div>
            <div>å•†å“æ•°: {{ weidianStats.totalItems }}</div>
          </div>
        </el-card>
      </el-col>
    </el-row>
    
    <!-- å®æ—¶æ—¥å¿— -->
    <el-card class="log-card" style="margin-top: 20px;">
      <template #header>
        <span>å®æ—¶æ—¥å¿—</span>
        <el-button @click="clearLogs" size="small" style="float: right;">
          æ¸…ç©º
        </el-button>
      </template>
      <div class="log-container">
        <div v-for="log in logs" :key="log.id" class="log-item">
          <span class="log-time">{{ formatTime(log.timestamp) }}</span>
          <span :class="`log-level log-${log.level}`">{{ log.level }}</span>
          <span class="log-message">{{ log.message }}</span>
        </div>
      </div>
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue';
import { useWebSocket } from '@/utils/websocket';
import { systemApi } from '@/api/system';

// å“åº”å¼æ•°æ®
const systemStatus = ref({ online: false });
const pocket48Stats = ref({ totalRooms: 0, totalStars: 0 });
const weiboStats = ref({ totalUsers: 0, totalTopics: 0 });
const weidianStats = ref({ totalShops: 0, totalItems: 0 });
const logs = ref<any[]>([]);

// WebSocketè¿æ¥
const { connect, disconnect, on } = useWebSocket();

// è·å–ç»Ÿè®¡æ•°æ®
const fetchStats = async () => {
  try {
    const stats = await systemApi.getStats();
    systemStatus.value = stats.system;
    pocket48Stats.value = stats.pocket48;
    weiboStats.value = stats.weibo;
    weidianStats.value = stats.weidian;
  } catch (error) {
    console.error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
  }
};

// æ ¼å¼åŒ–æ—¶é—´
const formatTime = (timestamp: number) => {
  return new Date(timestamp).toLocaleTimeString();
};

// æ¸…ç©ºæ—¥å¿—
const clearLogs = () => {
  logs.value = [];
};

// ç»„ä»¶æŒ‚è½½
onMounted(() => {
  fetchStats();
  
  // è¿æ¥WebSocket
  connect();
  
  // ç›‘å¬å®æ—¶æ—¥å¿—
  on('log', (logData) => {
    logs.value.unshift({
      id: Date.now(),
      ...logData
    });
    
    // é™åˆ¶æ—¥å¿—æ•°é‡
    if (logs.value.length > 100) {
      logs.value = logs.value.slice(0, 100);
    }
  });
  
  // ç›‘å¬ç»Ÿè®¡æ•°æ®æ›´æ–°
  on('stats', (statsData) => {
    systemStatus.value = statsData.system;
    pocket48Stats.value = statsData.pocket48;
    weiboStats.value = statsData.weibo;
    weidianStats.value = statsData.weidian;
  });
});

// ç»„ä»¶å¸è½½
onUnmounted(() => {
  disconnect();
});
</script>

<style scoped>
.dashboard {
  padding: 20px;
}

.status-card {
  text-align: center;
}

.status-item {
  font-size: 14px;
  line-height: 1.5;
}

.log-card {
  height: 400px;
}

.log-container {
  height: 320px;
  overflow-y: auto;
  font-family: 'Courier New', monospace;
  font-size: 12px;
}

.log-item {
  display: flex;
  margin-bottom: 4px;
  padding: 2px 0;
}

.log-time {
  color: #666;
  margin-right: 8px;
  min-width: 80px;
}

.log-level {
  margin-right: 8px;
  min-width: 50px;
  font-weight: bold;
}

.log-info { color: #409eff; }
.log-warn { color: #e6a23c; }
.log-error { color: #f56c6c; }
.log-debug { color: #909399; }

.log-message {
  flex: 1;
  word-break: break-all;
}
</style>
```

#### Day 4: APIå®¢æˆ·ç«¯å’ŒçŠ¶æ€ç®¡ç†

**src/api/client.ts** (å·²åœ¨å‰é¢æ–‡æ¡£ä¸­æä¾›)

**src/stores/auth.ts**
```typescript
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import { authApi } from '@/api/auth';

export const useAuthStore = defineStore('auth', () => {
  const token = ref(localStorage.getItem('newboy_token') || '');
  const user = ref<any>(null);
  
  const isAuthenticated = computed(() => !!token.value);
  
  const login = async (username: string, password: string) => {
    try {
      const response = await authApi.login(username, password);
      token.value = response.token;
      user.value = response.user;
      localStorage.setItem('newboy_token', response.token);
      return true;
    } catch (error) {
      console.error('ç™»å½•å¤±è´¥:', error);
      return false;
    }
  };
  
  const logout = () => {
    token.value = '';
    user.value = null;
    localStorage.removeItem('newboy_token');
  };
  
  return {
    token,
    user,
    isAuthenticated,
    login,
    logout
  };
});
```

#### Day 5: éƒ¨ç½²é…ç½®å’Œæµ‹è¯•

**vite.config.ts**
```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          element: ['element-plus']
        }
      }
    }
  },
  base: process.env.NODE_ENV === 'production' ? '/newboy-web-admin/' : '/'
});
```

### ğŸ¯ ç¬¬ä¸€é˜¶æ®µäº¤ä»˜ç‰©
- âœ… å®Œæ•´çš„Vue 3å‰ç«¯é¡¹ç›®
- âœ… æ ¸å¿ƒç®¡ç†ç•Œé¢ï¼ˆä»ªè¡¨æ¿ã€é…ç½®ç®¡ç†ï¼‰
- âœ… APIå®¢æˆ·ç«¯å’ŒçŠ¶æ€ç®¡ç†
- âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒ
- âœ… GitHub Pageséƒ¨ç½²é…ç½®

---

## ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šåç«¯APIå¼€å‘ (4-6å¤©)

### ğŸ“‹ ä»»åŠ¡æ¸…å•
- [ ] æ‰©å±•Newboyæ’ä»¶WebæœåŠ¡å™¨
- [ ] å®ç°RESTful APIæ¥å£
- [ ] æ·»åŠ JWTè®¤è¯æœºåˆ¶
- [ ] å®ç°WebSocketå®æ—¶é€šä¿¡
- [ ] é…ç½®CORSå’Œå®‰å…¨ç­–ç•¥

### ğŸ› ï¸ è¯¦ç»†å®æ–½æ­¥éª¤

#### Day 1-2: WebæœåŠ¡å™¨æ¡†æ¶æ­å»º

**æ·»åŠ ä¾èµ–åˆ°build.gradle.kts**
```kotlin
dependencies {
    // ç°æœ‰ä¾èµ–...
    
    // WebæœåŠ¡å™¨
    implementation("io.ktor:ktor-server-core:2.3.4")
    implementation("io.ktor:ktor-server-netty:2.3.4")
    implementation("io.ktor:ktor-server-content-negotiation:2.3.4")
    implementation("io.ktor:ktor-serialization-jackson:2.3.4")
    implementation("io.ktor:ktor-server-cors:2.3.4")
    implementation("io.ktor:ktor-server-websockets:2.3.4")
    implementation("io.ktor:ktor-server-auth:2.3.4")
    implementation("io.ktor:ktor-server-auth-jwt:2.3.4")
    
    // JWT
    implementation("com.auth0:java-jwt:4.4.0")
}
```

**WebServer.java**
```java
@Component
public class WebServer {
    private final WebServerConfig config;
    private final ApiController apiController;
    private final WebSocketHandler webSocketHandler;
    private ApplicationEngine server;
    
    public WebServer(WebServerConfig config, ApiController apiController, WebSocketHandler webSocketHandler) {
        this.config = config;
        this.apiController = apiController;
        this.webSocketHandler = webSocketHandler;
    }
    
    public void start() {
        if (!config.web_server_enabled) {
            return;
        }
        
        try {
            server = EngineMain.main(new String[]{
                "-port=" + config.web_server_port,
                "-host=" + config.web_server_host
            });
            
            logger.info("WebæœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç«¯å£: {}", config.web_server_port);
        } catch (Exception e) {
            logger.error("WebæœåŠ¡å™¨å¯åŠ¨å¤±è´¥", e);
        }
    }
    
    public void stop() {
        if (server != null) {
            server.stop(1000, 2000);
            logger.info("WebæœåŠ¡å™¨å·²åœæ­¢");
        }
    }
}
```

#### Day 3-4: APIæ§åˆ¶å™¨å®ç°

**ApiController.java**
```java
@RestController
@RequestMapping("/api")
public class ApiController {
    
    @Autowired
    private ConfigOperator configOperator;
    
    @Autowired
    private Properties properties;
    
    // ç³»ç»ŸçŠ¶æ€API
    @GetMapping("/system/status")
    public ResponseEntity<SystemStatus> getSystemStatus() {
        SystemStatus status = new SystemStatus();
        status.setOnline(true);
        status.setUptime(System.currentTimeMillis() - startTime);
        status.setMemoryUsage(getMemoryUsage());
        status.setCpuUsage(getCpuUsage());
        return ResponseEntity.ok(status);
    }
    
    // è·å–ç»Ÿè®¡æ•°æ®
    @GetMapping("/system/stats")
    public ResponseEntity<SystemStats> getStats() {
        SystemStats stats = new SystemStats();
        
        // Pocket48ç»Ÿè®¡
        stats.setPocket48Stats(getPocket48Stats());
        
        // å¾®åšç»Ÿè®¡
        stats.setWeiboStats(getWeiboStats());
        
        // å¾®åº—ç»Ÿè®¡
        stats.setWeidianStats(getWeidianStats());
        
        return ResponseEntity.ok(stats);
    }
    
    // Pocket48æˆ¿é—´ç®¡ç†
    @GetMapping("/pocket48/rooms")
    public ResponseEntity<List<Pocket48Room>> getPocket48Rooms() {
        List<Pocket48Room> rooms = configOperator.getPocket48Rooms();
        return ResponseEntity.ok(rooms);
    }
    
    @PostMapping("/pocket48/rooms")
    public ResponseEntity<String> addPocket48Room(@RequestBody Pocket48RoomRequest request) {
        try {
            configOperator.addPocket48RoomSubscribe(
                request.getRoomId(),
                request.getGroupId(),
                request.isAtEveryone()
            );
            return ResponseEntity.ok("æ·»åŠ æˆåŠŸ");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("æ·»åŠ å¤±è´¥: " + e.getMessage());
        }
    }
    
    @DeleteMapping("/pocket48/rooms/{roomId}")
    public ResponseEntity<String> removePocket48Room(@PathVariable String roomId) {
        try {
            configOperator.rmPocket48RoomSubscribe(roomId);
            return ResponseEntity.ok("åˆ é™¤æˆåŠŸ");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("åˆ é™¤å¤±è´¥: " + e.getMessage());
        }
    }
    
    // å¾®åšç”¨æˆ·ç®¡ç†
    @GetMapping("/weibo/users")
    public ResponseEntity<List<WeiboUser>> getWeiboUsers() {
        List<WeiboUser> users = configOperator.getWeiboUsers();
        return ResponseEntity.ok(users);
    }
    
    @PostMapping("/weibo/users")
    public ResponseEntity<String> addWeiboUser(@RequestBody WeiboUserRequest request) {
        try {
            configOperator.addWeiboUserSubscribe(
                request.getUserId(),
                request.getGroupId(),
                request.isAtEveryone()
            );
            return ResponseEntity.ok("æ·»åŠ æˆåŠŸ");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("æ·»åŠ å¤±è´¥: " + e.getMessage());
        }
    }
    
    // é…ç½®ç®¡ç†
    @GetMapping("/config")
    public ResponseEntity<Properties> getConfig() {
        return ResponseEntity.ok(properties);
    }
    
    @PutMapping("/config")
    public ResponseEntity<String> updateConfig(@RequestBody Properties newConfig) {
        try {
            // æ›´æ–°é…ç½®
            updateProperties(newConfig);
            configOperator.safeStoreConfig();
            return ResponseEntity.ok("é…ç½®æ›´æ–°æˆåŠŸ");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("é…ç½®æ›´æ–°å¤±è´¥: " + e.getMessage());
        }
    }
}
```

#### Day 5: WebSocketå®æ—¶é€šä¿¡

**WebSocketHandler.java**
```java
@Component
public class WebSocketHandler {
    private final Set<WebSocketSession> sessions = ConcurrentHashMap.newKeySet();
    private final ObjectMapper objectMapper = new ObjectMapper();
    
    public void handleConnection(WebSocketSession session) {
        sessions.add(session);
        logger.info("WebSocketè¿æ¥å»ºç«‹: {}", session.getId());
        
        // å‘é€åˆå§‹çŠ¶æ€
        sendToSession(session, "status", getSystemStatus());
    }
    
    public void handleDisconnection(WebSocketSession session) {
        sessions.remove(session);
        logger.info("WebSocketè¿æ¥æ–­å¼€: {}", session.getId());
    }
    
    public void broadcastLog(String level, String message) {
        LogMessage logMsg = new LogMessage();
        logMsg.setLevel(level);
        logMsg.setMessage(message);
        logMsg.setTimestamp(System.currentTimeMillis());
        
        broadcast("log", logMsg);
    }
    
    public void broadcastStats(SystemStats stats) {
        broadcast("stats", stats);
    }
    
    private void broadcast(String type, Object data) {
        String message = createMessage(type, data);
        sessions.removeIf(session -> {
            try {
                session.sendMessage(new TextMessage(message));
                return false;
            } catch (Exception e) {
                logger.warn("å‘é€WebSocketæ¶ˆæ¯å¤±è´¥: {}", e.getMessage());
                return true; // ç§»é™¤å¤±æ•ˆçš„è¿æ¥
            }
        });
    }
    
    private void sendToSession(WebSocketSession session, String type, Object data) {
        try {
            String message = createMessage(type, data);
            session.sendMessage(new TextMessage(message));
        } catch (Exception e) {
            logger.warn("å‘é€WebSocketæ¶ˆæ¯å¤±è´¥: {}", e.getMessage());
        }
    }
    
    private String createMessage(String type, Object data) {
        try {
            Map<String, Object> message = new HashMap<>();
            message.put("type", type);
            message.put("data", data);
            message.put("timestamp", System.currentTimeMillis());
            return objectMapper.writeValueAsString(message);
        } catch (Exception e) {
            logger.error("åˆ›å»ºWebSocketæ¶ˆæ¯å¤±è´¥", e);
            return "{}";
        }
    }
}
```

#### Day 6: å®‰å…¨å’Œè®¤è¯

**JwtAuthService.java** (å·²åœ¨å‰é¢æ–‡æ¡£ä¸­æä¾›)

**SecurityConfig.java**
```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOriginPatterns(Arrays.asList(
            "https://*.github.io",
            "http://localhost:*"
        ));
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        configuration.setAllowedHeaders(Arrays.asList("*"));
        configuration.setAllowCredentials(true);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/api/**", configuration);
        return source;
    }
}
```

### ğŸ¯ ç¬¬äºŒé˜¶æ®µäº¤ä»˜ç‰©
- âœ… å®Œæ•´çš„RESTful APIæ¥å£
- âœ… JWTè®¤è¯æœºåˆ¶
- âœ… WebSocketå®æ—¶é€šä¿¡
- âœ… CORSå’Œå®‰å…¨é…ç½®
- âœ… é…ç½®ç®¡ç†API

---

## ğŸŒ ç¬¬ä¸‰é˜¶æ®µï¼šæœåŠ¡å™¨éƒ¨ç½²é…ç½® (3-4å¤©)

### ğŸ“‹ ä»»åŠ¡æ¸…å•
- [ ] é…ç½®åå‘ä»£ç†æœåŠ¡å™¨
- [ ] ç”³è¯·å’Œé…ç½®SSLè¯ä¹¦
- [ ] é…ç½®é˜²ç«å¢™å’Œå®‰å…¨ç­–ç•¥
- [ ] éƒ¨ç½²å‰ç«¯åˆ°GitHub Pages
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### ğŸ› ï¸ è¯¦ç»†å®æ–½æ­¥éª¤

#### Day 1: æœåŠ¡å™¨åŸºç¡€é…ç½®

```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install -y nginx certbot python3-certbot-nginx ufw htop

# 3. é…ç½®é˜²ç«å¢™
sudo ufw allow 22/tcp      # SSH
sudo ufw allow 80/tcp      # HTTP
sudo ufw allow 443/tcp     # HTTPS
sudo ufw deny 8080/tcp     # ç¦æ­¢ç›´æ¥è®¿é—®Newboyç«¯å£
sudo ufw --force enable

# 4. é…ç½®ç³»ç»ŸæœåŠ¡
sudo systemctl enable nginx
sudo systemctl start nginx
```

#### Day 2: Nginxé…ç½®

**/etc/nginx/sites-available/newboy**
```nginx
# ä¸´æ—¶HTTPé…ç½®ï¼ˆç”¨äºç”³è¯·SSLè¯ä¹¦ï¼‰
server {
    listen 80;
    server_name your-domain.com;
    
    location /.well-known/acme-challenge/ {
        root /var/www/html;
    }
    
    location / {
        return 301 https://$server_name$request_uri;
    }
}
```

```bash
# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/newboy /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### Day 3: SSLè¯ä¹¦é…ç½®

```bash
# 1. ç”³è¯·Let's Encryptè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# 2. è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ:
# 0 12 * * * /usr/bin/certbot renew --quiet
```

**æ›´æ–°Nginxé…ç½®**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    # SSLé…ç½®ï¼ˆç”±certbotè‡ªåŠ¨ç”Ÿæˆï¼‰
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval';" always;
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # CORSé…ç½®
        add_header Access-Control-Allow-Origin "https://your-username.github.io" always;
        add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With" always;
        add_header Access-Control-Allow-Credentials "true" always;
        
        # é¢„æ£€è¯·æ±‚å¤„ç†
        if ($request_method = 'OPTIONS') {
            add_header Access-Control-Allow-Origin "https://your-username.github.io";
            add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
            add_header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With";
            add_header Access-Control-Allow-Credentials "true";
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            return 204;
        }
    }
    
    # WebSocketä»£ç†
    location /ws/ {
        proxy_pass http://127.0.0.1:8080/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocketè¶…æ—¶è®¾ç½®
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
    }
    
    # å¥åº·æ£€æŸ¥
    location /health {
        proxy_pass http://127.0.0.1:8080/health;
        access_log off;
    }
    
    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/newboy_access.log;
    error_log /var/log/nginx/newboy_error.log;
}
```

#### Day 4: å‰ç«¯éƒ¨ç½²å’Œæµ‹è¯•

**GitHub Actionsé…ç½®** (å·²åœ¨å‰é¢æ–‡æ¡£ä¸­æä¾›)

**éƒ¨ç½²å‰ç«¯**
```bash
# 1. æ¨é€ä»£ç åˆ°GitHub
git add .
git commit -m "Deploy to GitHub Pages"
git push origin main

# 2. åœ¨GitHubä»“åº“è®¾ç½®ä¸­å¯ç”¨Pages
# Settings -> Pages -> Source: GitHub Actions
```

**ç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬**
```bash
#!/bin/bash
# test-deployment.sh

API_BASE="https://your-domain.com/api"
FRONTEND_URL="https://your-username.github.io/newboy-web-admin"

echo "ğŸ§ª å¼€å§‹ç«¯åˆ°ç«¯æµ‹è¯•..."

# 1. æµ‹è¯•APIå¥åº·æ£€æŸ¥
echo "ğŸ“¡ æµ‹è¯•APIå¥åº·æ£€æŸ¥..."
if curl -f "$API_BASE/health" > /dev/null 2>&1; then
    echo "âœ… APIå¥åº·æ£€æŸ¥é€šè¿‡"
else
    echo "âŒ APIå¥åº·æ£€æŸ¥å¤±è´¥"
    exit 1
fi

# 2. æµ‹è¯•CORS
echo "ğŸŒ æµ‹è¯•CORSé…ç½®..."
CORS_RESULT=$(curl -s -H "Origin: $FRONTEND_URL" \
                   -H "Access-Control-Request-Method: GET" \
                   -X OPTIONS "$API_BASE/system/status")
if [[ $? -eq 0 ]]; then
    echo "âœ… CORSé…ç½®æ­£ç¡®"
else
    echo "âŒ CORSé…ç½®å¤±è´¥"
    exit 1
fi

# 3. æµ‹è¯•å‰ç«¯è®¿é—®
echo "ğŸ–¥ï¸ æµ‹è¯•å‰ç«¯è®¿é—®..."
if curl -f "$FRONTEND_URL" > /dev/null 2>&1; then
    echo "âœ… å‰ç«¯è®¿é—®æ­£å¸¸"
else
    echo "âŒ å‰ç«¯è®¿é—®å¤±è´¥"
    exit 1
fi

# 4. æµ‹è¯•SSLè¯ä¹¦
echo "ğŸ”’ æµ‹è¯•SSLè¯ä¹¦..."
SSL_RESULT=$(echo | openssl s_client -servername your-domain.com -connect your-domain.com:443 2>/dev/null | openssl x509 -noout -dates)
if [[ $? -eq 0 ]]; then
    echo "âœ… SSLè¯ä¹¦æœ‰æ•ˆ"
    echo "$SSL_RESULT"
else
    echo "âŒ SSLè¯ä¹¦æ— æ•ˆ"
    exit 1
fi

echo "ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼éƒ¨ç½²æˆåŠŸï¼"
echo "ğŸ“± å‰ç«¯åœ°å€: $FRONTEND_URL"
echo "ğŸ”— APIåœ°å€: $API_BASE"
```

### ğŸ¯ ç¬¬ä¸‰é˜¶æ®µäº¤ä»˜ç‰©
- âœ… é…ç½®å®Œæˆçš„åå‘ä»£ç†æœåŠ¡å™¨
- âœ… æœ‰æ•ˆçš„SSLè¯ä¹¦
- âœ… å®‰å…¨çš„é˜²ç«å¢™é…ç½®
- âœ… éƒ¨ç½²åˆ°GitHub Pagesçš„å‰ç«¯
- âœ… å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•

---

## ğŸ“Š ç¬¬å››é˜¶æ®µï¼šç›‘æ§å’Œä¼˜åŒ– (2-3å¤©)

### ğŸ“‹ ä»»åŠ¡æ¸…å•
- [ ] é…ç½®ç³»ç»Ÿç›‘æ§
- [ ] å®ç°æ—¥å¿—èšåˆ
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- [ ] æ–‡æ¡£å®Œå–„

### ğŸ› ï¸ è¯¦ç»†å®æ–½æ­¥éª¤

#### Day 1: ç›‘æ§é…ç½®

**ç³»ç»Ÿç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# monitor.sh

LOG_FILE="/var/log/newboy-monitor.log"
API_URL="http://localhost:8080/api/health"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

# æ£€æŸ¥APIæœåŠ¡
check_api() {
    if curl -f "$API_URL" > /dev/null 2>&1; then
        log "âœ… APIæœåŠ¡æ­£å¸¸"
        return 0
    else
        log "âŒ APIæœåŠ¡å¼‚å¸¸"
        return 1
    fi
}

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
check_memory() {
    MEMORY_USAGE=$(free | grep Mem | awk '{printf "%.2f", $3/$2 * 100.0}')
    log "ğŸ“Š å†…å­˜ä½¿ç”¨ç‡: ${MEMORY_USAGE}%"
    
    if (( $(echo "$MEMORY_USAGE > 90" | bc -l) )); then
        log "âš ï¸ å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${MEMORY_USAGE}%"
    fi
}

# æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk() {
    DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
    log "ğŸ’¾ ç£ç›˜ä½¿ç”¨ç‡: ${DISK_USAGE}%"
    
    if [ "$DISK_USAGE" -gt 85 ]; then
        log "âš ï¸ ç£ç›˜ç©ºé—´ä¸è¶³: ${DISK_USAGE}%"
    fi
}

# ä¸»ç›‘æ§å¾ªç¯
main() {
    log "ğŸš€ å¼€å§‹ç³»ç»Ÿç›‘æ§"
    
    while true; do
        check_api
        check_memory
        check_disk
        
        sleep 300  # 5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    done
}

main
```

**è®¾ç½®å®šæ—¶ä»»åŠ¡**
```bash
# æ·»åŠ åˆ°crontab
crontab -e

# æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ç³»ç»ŸçŠ¶æ€
*/5 * * * * /path/to/monitor.sh

# æ¯å¤©å‡Œæ™¨æ¸…ç†æ—§æ—¥å¿—
0 0 * * * find /var/log -name "*.log" -mtime +7 -delete
```

#### Day 2: æ€§èƒ½ä¼˜åŒ–

**Nginxæ€§èƒ½ä¼˜åŒ–**
```nginx
# åœ¨httpå—ä¸­æ·»åŠ 
http {
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml;
    
    # ç¼“å­˜é…ç½®
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=100m inactive=60m use_temp_path=off;
    
    # è¿æ¥ä¼˜åŒ–
    keepalive_timeout 65;
    keepalive_requests 100;
    
    # ç¼“å†²åŒºä¼˜åŒ–
    client_body_buffer_size 128k;
    client_max_body_size 10m;
    client_header_buffer_size 1k;
    large_client_header_buffers 4 4k;
    output_buffers 1 32k;
    postpone_output 1460;
}
```

**JVMæ€§èƒ½ä¼˜åŒ–**
```bash
# åœ¨å¯åŠ¨è„šæœ¬ä¸­æ·»åŠ JVMå‚æ•°
JAVA_OPTS="-Xms512m -Xmx1024m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+UseStringDeduplication"
```

#### Day 3: è‡ªåŠ¨åŒ–å’Œæ–‡æ¡£

**è‡ªåŠ¨éƒ¨ç½²è„šæœ¬**
```bash
#!/bin/bash
# auto-deploy.sh

set -e

PROJECT_DIR="/opt/newboy"
BACKUP_DIR="/opt/backups"
LOG_FILE="/var/log/newboy-deploy.log"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# åˆ›å»ºå¤‡ä»½
create_backup() {
    log "ğŸ“¦ åˆ›å»ºå¤‡ä»½..."
    BACKUP_NAME="newboy-backup-$(date +%Y%m%d-%H%M%S)"
    mkdir -p "$BACKUP_DIR"
    cp -r "$PROJECT_DIR" "$BACKUP_DIR/$BACKUP_NAME"
    log "âœ… å¤‡ä»½åˆ›å»ºå®Œæˆ: $BACKUP_DIR/$BACKUP_NAME"
}

# æ›´æ–°ä»£ç 
update_code() {
    log "ğŸ“¥ æ›´æ–°ä»£ç ..."
    cd "$PROJECT_DIR"
    git pull origin main
    log "âœ… ä»£ç æ›´æ–°å®Œæˆ"
}

# æ„å»ºé¡¹ç›®
build_project() {
    log "ğŸ”¨ æ„å»ºé¡¹ç›®..."
    cd "$PROJECT_DIR"
    ./gradlew clean build
    log "âœ… é¡¹ç›®æ„å»ºå®Œæˆ"
}

# é‡å¯æœåŠ¡
restart_service() {
    log "ğŸ”„ é‡å¯æœåŠ¡..."
    sudo systemctl restart newboy
    sudo systemctl reload nginx
    log "âœ… æœåŠ¡é‡å¯å®Œæˆ"
}

# å¥åº·æ£€æŸ¥
health_check() {
    log "ğŸ¥ æ‰§è¡Œå¥åº·æ£€æŸ¥..."
    sleep 10  # ç­‰å¾…æœåŠ¡å¯åŠ¨
    
    for i in {1..5}; do
        if curl -f "http://localhost:8080/api/health" > /dev/null 2>&1; then
            log "âœ… å¥åº·æ£€æŸ¥é€šè¿‡"
            return 0
        fi
        log "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨... ($i/5)"
        sleep 5
    done
    
    log "âŒ å¥åº·æ£€æŸ¥å¤±è´¥"
    return 1
}

# å›æ»š
rollback() {
    log "ğŸ”™ æ‰§è¡Œå›æ»š..."
    LATEST_BACKUP=$(ls -t "$BACKUP_DIR" | head -n1)
    if [ -n "$LATEST_BACKUP" ]; then
        rm -rf "$PROJECT_DIR"
        cp -r "$BACKUP_DIR/$LATEST_BACKUP" "$PROJECT_DIR"
        restart_service
        log "âœ… å›æ»šå®Œæˆ"
    else
        log "âŒ æ²¡æœ‰å¯ç”¨çš„å¤‡ä»½"
    fi
}

# ä¸»éƒ¨ç½²æµç¨‹
main() {
    log "ğŸš€ å¼€å§‹è‡ªåŠ¨éƒ¨ç½²"
    
    create_backup
    
    if update_code && build_project && restart_service && health_check; then
        log "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼"
    else
        log "ğŸ’¥ éƒ¨ç½²å¤±è´¥ï¼Œæ‰§è¡Œå›æ»š"
        rollback
        exit 1
    fi
}

main
```

### ğŸ¯ ç¬¬å››é˜¶æ®µäº¤ä»˜ç‰©
- âœ… å®Œæ•´çš„ç›‘æ§ç³»ç»Ÿ
- âœ… æ€§èƒ½ä¼˜åŒ–é…ç½®
- âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- âœ… å®Œå–„çš„æ–‡æ¡£

---

## ğŸ“‹ æ€»ç»“æ£€æŸ¥æ¸…å•

### âœ… å‰ç«¯éƒ¨åˆ†
- [ ] Vue 3 + TypeScripté¡¹ç›®åˆ›å»º
- [ ] æ ¸å¿ƒç®¡ç†ç•Œé¢å¼€å‘
- [ ] APIå®¢æˆ·ç«¯é…ç½®
- [ ] çŠ¶æ€ç®¡ç†å®ç°
- [ ] GitHub Pageséƒ¨ç½²é…ç½®
- [ ] ç¯å¢ƒå˜é‡é…ç½®

### âœ… åç«¯éƒ¨åˆ†
- [ ] WebæœåŠ¡å™¨æ¡†æ¶é›†æˆ
- [ ] RESTful APIæ¥å£å®ç°
- [ ] JWTè®¤è¯æœºåˆ¶
- [ ] WebSocketå®æ—¶é€šä¿¡
- [ ] CORSå’Œå®‰å…¨é…ç½®
- [ ] é…ç½®ç®¡ç†API

### âœ… éƒ¨ç½²éƒ¨åˆ†
- [ ] æœåŠ¡å™¨åŸºç¡€é…ç½®
- [ ] Nginxåå‘ä»£ç†é…ç½®
- [ ] SSLè¯ä¹¦ç”³è¯·å’Œé…ç½®
- [ ] é˜²ç«å¢™å’Œå®‰å…¨ç­–ç•¥
- [ ] åŸŸåDNSé…ç½®
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### âœ… è¿ç»´éƒ¨åˆ†
- [ ] ç³»ç»Ÿç›‘æ§é…ç½®
- [ ] æ—¥å¿—ç®¡ç†
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- [ ] å¤‡ä»½å’Œæ¢å¤ç­–ç•¥

## ğŸ¯ é¢„æœŸæˆæœ

å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ï¼š

1. **ç°ä»£åŒ–çš„Webç®¡ç†ç•Œé¢** - éƒ¨ç½²åœ¨GitHub Pagesä¸Šï¼Œæ”¯æŒå“åº”å¼è®¾è®¡
2. **å®‰å…¨çš„è¿œç¨‹è®¿é—®** - é€šè¿‡HTTPSå’ŒJWTè®¤è¯ä¿æŠ¤
3. **å®æ—¶æ•°æ®åŒæ­¥** - WebSocketæ”¯æŒå®æ—¶çŠ¶æ€æ›´æ–°
4. **å®Œæ•´çš„é…ç½®ç®¡ç†** - æ”¯æŒæ‰€æœ‰Newboyæ’ä»¶é…ç½®çš„åœ¨çº¿ä¿®æ”¹
5. **ç›‘æ§å’Œå‘Šè­¦** - ç³»ç»ŸçŠ¶æ€ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦
6. **è‡ªåŠ¨åŒ–è¿ç»´** - ä¸€é”®éƒ¨ç½²å’Œå›æ»šèƒ½åŠ›

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨å®æ–½è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒï¼š

1. **å‰ç«¯é—®é¢˜** - Vue.jså®˜æ–¹æ–‡æ¡£ã€Element Plusæ–‡æ¡£
2. **åç«¯é—®é¢˜** - Spring Bootæ–‡æ¡£ã€Ktoræ–‡æ¡£
3. **éƒ¨ç½²é—®é¢˜** - Nginxæ–‡æ¡£ã€Let's Encryptæ–‡æ¡£
4. **ç›‘æ§é—®é¢˜** - ç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨æ—¥å¿—

---

**ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€